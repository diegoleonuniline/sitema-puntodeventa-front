<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#2D3DBF">
    <title>CAFI - Configuración</title>
    <link rel="stylesheet" href="empresas.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="app-layout">
        <!-- SIDEBAR -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <svg viewBox="0 0 500 500" width="36" height="36">
                    <g transform="translate(0,500) scale(0.1,-0.1)">
                        <path fill="#fff" d="M905 3775 c-5 -2 -22 -6 -37 -9 -62 -14 -127 -102 -128 -174 0 -43 24 -100 58 -135 39 -41 107 -57 246 -57 l121 0 136 -137 137 -138 59 -145 c33 -80 89 -219 124 -309 l64 -165 7 105 c9 150 39 265 103 394 74 150 174 267 305 357 24 16 16 17 -180 17 l-205 1 -175 176 c-96 96 -193 185 -215 197 -37 20 -56 22 -225 24 -102 1 -189 1 -195 -2z"/>
                        <path fill="#a78bfa" d="M3270 3352 c143 -112 231 -234 285 -399 14 -43 28 -105 32 -138 9 -98 16 -96 -293 -93 l-259 3 -30 58 c-43 83 -88 133 -148 165 -48 25 -61 27 -172 27 -112 0 -124 -2 -178 -29 -60 -30 -126 -95 -157 -156 -39 -77 -52 -147 -48 -264 3 -104 6 -116 40 -188 78 -163 207 -239 382 -225 135 12 252 97 286 210 23 80 11 77 301 77 l258 0 18 -23 17 -24 40 101 c21 56 99 254 174 441 80 202 135 355 136 377 1 45 -32 84 -83 98 -20 6 -168 10 -336 10 l-300 0 35 -28z"/>
                    </g>
                </svg>
                <span>CAFI</span>
            </div>
            
            <nav class="sidebar-nav">
                <a href="../pos/index.html" class="nav-item">
                    <i class="fas fa-cash-register"></i>
                    <span>Punto de Venta</span>
                </a>
                <a href="#" class="nav-item active">
                    <i class="fas fa-cogs"></i>
                    <span>Configuración</span>
                </a>
                <div class="nav-divider"></div>
                <a href="#" class="nav-item" data-section="empresa">
                    <i class="fas fa-building"></i>
                    <span>Mi Empresa</span>
                </a>
                <a href="#" class="nav-item" data-section="sucursales">
                    <i class="fas fa-map-marker-alt"></i>
                    <span>Sucursales</span>
                </a>
                <a href="#" class="nav-item" data-section="almacenes">
                    <i class="fas fa-warehouse"></i>
                    <span>Almacenes</span>
                </a>
                <a href="#" class="nav-item" data-section="usuarios">
                    <i class="fas fa-users"></i>
                    <span>Usuarios</span>
                </a>
                <div class="nav-divider"></div>
                <a href="#" class="nav-item" data-section="impuestos">
                    <i class="fas fa-percent"></i>
                    <span>Impuestos</span>
                </a>
                <a href="#" class="nav-item" data-section="metodos-pago">
                    <i class="fas fa-credit-card"></i>
                    <span>Métodos de Pago</span>
                </a>
                <a href="#" class="nav-item" data-section="unidades">
                    <i class="fas fa-balance-scale"></i>
                    <span>Unidades de Medida</span>
                </a>
                <a href="#" class="nav-item" data-section="categorias">
                    <i class="fas fa-tags"></i>
                    <span>Categorías</span>
                </a>
            </nav>
            
            <div class="sidebar-footer">
                <div class="user-mini">
                    <div class="user-avatar" id="userAvatar">US</div>
                    <div class="user-info">
                        <span id="userName">Usuario</span>
                        <small id="userRol">Rol</small>
                    </div>
                </div>
                <button class="btn-logout" onclick="API.logout()" title="Cerrar sesión">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </aside>

        <!-- MAIN CONTENT -->
        <main class="main-content">
            <!-- HEADER -->
            <header class="main-header">
                <button class="btn-menu" id="btnMenu"><i class="fas fa-bars"></i></button>
                <div class="header-title">
                    <h1 id="pageTitle"><i class="fas fa-building"></i> Mi Empresa</h1>
                    <p id="pageSubtitle">Datos y configuración de tu empresa</p>
                </div>
                <div class="header-actions" id="headerActions"></div>
            </header>

            <!-- ==================== SECCIÓN EMPRESA ==================== -->
            <section class="content-section active" id="seccionEmpresa">
                <!-- Datos Generales -->
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-building"></i> Datos Generales</h3>
                    </div>
                    <div class="card-body">
                        <form id="formEmpresa" class="form-grid">
                            <div class="form-group col-span-2">
                                <label>Nombre / Razón Social *</label>
                                <input type="text" id="emp_nombre" required>
                            </div>
                            <div class="form-group col-span-2">
                                <label>Nombre Comercial</label>
                                <input type="text" id="emp_nombre_comercial" placeholder="Nombre público de tu negocio">
                            </div>
                            <div class="form-group">
                                <label>RFC</label>
                                <input type="text" id="emp_rfc" maxlength="13" style="text-transform:uppercase;" placeholder="XAXX010101000">
                            </div>
                            <div class="form-group">
                                <label>Régimen Fiscal</label>
                                <select id="emp_regimen_fiscal">
                                    <option value="">-- Seleccionar --</option>
                                    <option value="601">601 - General de Ley PM</option>
                                    <option value="603">603 - Personas Morales sin fines de lucro</option>
                                    <option value="605">605 - Sueldos y Salarios</option>
                                    <option value="606">606 - Arrendamiento</option>
                                    <option value="612">612 - Personas Físicas Actividades Empresariales</option>
                                    <option value="621">621 - Incorporación Fiscal</option>
                                    <option value="625">625 - RESICO</option>
                                    <option value="626">626 - RESICO Personas Morales</option>
                                </select>
                            </div>
                            <div class="form-group col-span-2">
                                <label>Dirección</label>
                                <input type="text" id="emp_direccion" placeholder="Calle, número">
                            </div>
                            <div class="form-group">
                                <label>Ciudad</label>
                                <input type="text" id="emp_ciudad">
                            </div>
                            <div class="form-group">
                                <label>Estado</label>
                                <input type="text" id="emp_estado">
                            </div>
                            <div class="form-group">
                                <label>Código Postal</label>
                                <input type="text" id="emp_codigo_postal" maxlength="10">
                            </div>
                            <div class="form-group">
                                <label>País</label>
                                <select id="emp_pais_id">
                                    <option value="MX">México</option>
                                    <option value="US">Estados Unidos</option>
                                    <option value="GT">Guatemala</option>
                                    <option value="CO">Colombia</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Teléfono</label>
                                <input type="tel" id="emp_telefono">
                            </div>
                            <div class="form-group">
                                <label>Email</label>
                                <input type="email" id="emp_email">
                            </div>
                            <div class="form-group">
                                <label>Sitio Web</label>
                                <input type="url" id="emp_website" placeholder="https://">
                            </div>
                            <div class="form-group">
                                <label>Logo URL</label>
                                <input type="url" id="emp_logo_url" placeholder="https://...logo.png">
                            </div>
                            <div class="form-actions col-span-2">
                                <button type="submit" class="btn btn-success">
                                    <i class="fas fa-save"></i> Guardar Empresa
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Configuración Regional -->
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-globe"></i> Configuración Regional</h3>
                    </div>
                    <div class="card-body">
                        <form id="formRegional" class="form-grid">
                            <div class="form-group">
                                <label>Moneda</label>
                                <select id="emp_moneda_id">
                                    <option value="MXN">MXN - Peso Mexicano</option>
                                    <option value="USD">USD - Dólar Americano</option>
                                    <option value="EUR">EUR - Euro</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Zona Horaria</label>
                                <select id="emp_zona_horaria">
                                    <option value="America/Mexico_City">Ciudad de México (GMT-6)</option>
                                    <option value="America/Tijuana">Tijuana (GMT-8)</option>
                                    <option value="America/Cancun">Cancún (GMT-5)</option>
                                    <option value="America/Hermosillo">Hermosillo (GMT-7)</option>
                                </select>
                            </div>
                            <div class="form-group switch-group">
                                <label>Empresa Activa</label>
                                <label class="switch">
                                    <input type="checkbox" id="emp_activa" checked>
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="form-group">
                                <label>Fecha Vencimiento Plan</label>
                                <input type="date" id="emp_fecha_vencimiento" disabled>
                            </div>
                            <div class="form-actions col-span-2">
                                <button type="submit" class="btn btn-success">
                                    <i class="fas fa-save"></i> Guardar Regional
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Programa de Puntos -->
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-star"></i> Programa de Puntos / Lealtad</h3>
                    </div>
                    <div class="card-body">
                        <form id="formPuntos" class="form-grid">
                            <div class="form-group switch-group col-span-2">
                                <label><strong>Activar Programa de Puntos</strong></label>
                                <label class="switch">
                                    <input type="checkbox" id="emp_puntos_activo">
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="form-group">
                                <label>Puntos por cada $1</label>
                                <input type="number" id="emp_puntos_por_peso" step="0.01" min="0" value="10">
                                <small class="help-text">Ej: 10 puntos por cada peso</small>
                            </div>
                            <div class="form-group">
                                <label>Valor de cada punto en $</label>
                                <input type="number" id="emp_punto_valor_redencion" step="0.01" min="0" value="0.50">
                                <small class="help-text">Ej: cada punto vale $0.50</small>
                            </div>
                            <div class="form-group col-span-2">
                                <label>Mínimo de puntos para canjear</label>
                                <input type="number" id="emp_puntos_minimo_redimir" min="0" value="100">
                                <small class="help-text">Puntos mínimos para poder canjear</small>
                            </div>
                            <div class="form-actions col-span-2">
                                <button type="submit" class="btn btn-success">
                                    <i class="fas fa-save"></i> Guardar Puntos
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </section>

            <!-- ==================== SECCIÓN SUCURSALES ==================== -->
            <section class="content-section" id="seccionSucursales">
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-map-marker-alt"></i> Sucursales</h3>
                        <button class="btn btn-primary btn-sm" onclick="abrirModalSucursal()">
                            <i class="fas fa-plus"></i> Nueva Sucursal
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Código</th>
                                        <th>Nombre</th>
                                        <th>Tipo</th>
                                        <th>Ciudad</th>
                                        <th>Responsable</th>
                                        <th>Horario</th>
                                        <th>Estado</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="tablaSucursales">
                                    <tr><td colspan="8" class="empty">Cargando...</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ==================== SECCIÓN ALMACENES ==================== -->
            <section class="content-section" id="seccionAlmacenes">
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-warehouse"></i> Almacenes</h3>
                        <button class="btn btn-primary btn-sm" onclick="abrirModalAlmacen()">
                            <i class="fas fa-plus"></i> Nuevo Almacén
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Código</th>
                                        <th>Nombre</th>
                                        <th>Sucursal</th>
                                        <th>Tipo</th>
                                        <th>Punto Venta</th>
                                        <th>Negativos</th>
                                        <th>Estado</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="tablaAlmacenes">
                                    <tr><td colspan="8" class="empty">Cargando...</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ==================== SECCIÓN USUARIOS ==================== -->
            <section class="content-section" id="seccionUsuarios">
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-users"></i> Usuarios</h3>
                        <button class="btn btn-primary btn-sm" onclick="abrirModalUsuario()">
                            <i class="fas fa-plus"></i> Nuevo Usuario
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Nombre</th>
                                        <th>Email</th>
                                        <th>Rol</th>
                                        <th>Sucursal</th>
                                        <th>Último Acceso</th>
                                        <th>Estado</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="tablaUsuarios">
                                    <tr><td colspan="7" class="empty">Cargando...</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ==================== SECCIÓN IMPUESTOS ==================== -->
            <section class="content-section" id="seccionImpuestos">
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-percent"></i> Impuestos</h3>
                        <button class="btn btn-primary btn-sm" onclick="abrirModalImpuesto()">
                            <i class="fas fa-plus"></i> Nuevo Impuesto
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Nombre</th>
                                        <th>Tipo</th>
                                        <th>Valor</th>
                                        <th>Incluido</th>
                                        <th>Compras</th>
                                        <th>Ventas</th>
                                        <th>Estado</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="tablaImpuestos">
                                    <tr><td colspan="8" class="empty">Cargando...</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ==================== SECCIÓN MÉTODOS DE PAGO ==================== -->
            <section class="content-section" id="seccionMetodosPago">
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-credit-card"></i> Métodos de Pago</h3>
                        <button class="btn btn-primary btn-sm" onclick="abrirModalMetodoPago()">
                            <i class="fas fa-plus"></i> Nuevo Método
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>Nombre</th>
                                        <th>Tipo</th>
                                        <th>Referencia</th>
                                        <th>Cambio</th>
                                        <th>Comisión %</th>
                                        <th>Comisión $</th>
                                        <th>Estado</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="tablaMetodosPago">
                                    <tr><td colspan="9" class="empty">Cargando...</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ==================== SECCIÓN UNIDADES ==================== -->
            <section class="content-section" id="seccionUnidades">
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-balance-scale"></i> Unidades de Medida</h3>
                        <button class="btn btn-primary btn-sm" onclick="abrirModalUnidad()">
                            <i class="fas fa-plus"></i> Nueva Unidad
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>ID/Código</th>
                                        <th>Nombre</th>
                                        <th>Abreviatura</th>
                                        <th>Tipo</th>
                                        <th>Sistema</th>
                                        <th>Estado</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="tablaUnidades">
                                    <tr><td colspan="7" class="empty">Cargando...</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ==================== SECCIÓN CATEGORÍAS ==================== -->
            <section class="content-section" id="seccionCategorias">
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-tags"></i> Categorías de Productos</h3>
                        <button class="btn btn-primary btn-sm" onclick="abrirModalCategoria()">
                            <i class="fas fa-plus"></i> Nueva Categoría
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Código</th>
                                        <th>Nombre</th>
                                        <th>Padre</th>
                                        <th>Color</th>
                                        <th>POS</th>
                                        <th>E-Commerce</th>
                                        <th>Orden</th>
                                        <th>Estado</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="tablaCategorias">
                                    <tr><td colspan="9" class="empty">Cargando...</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- ==================== MODALES ==================== -->
    
    <!-- Modal Sucursal COMPLETO -->
    <div class="modal-overlay" id="modalSucursal">
        <div class="modal modal-lg">
            <div class="modal-header">
                <h3><i class="fas fa-map-marker-alt"></i> <span id="modalSucursalTitulo">Nueva Sucursal</span></h3>
                <button class="btn-close" onclick="cerrarModal('modalSucursal')"><i class="fas fa-times"></i></button>
            </div>
            <form id="formSucursal" onsubmit="guardarSucursal(event)">
                <div class="modal-body">
                    <input type="hidden" id="suc_id">
                    
                    <div class="form-section">
                        <h4><i class="fas fa-info-circle"></i> Información General</h4>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Código</label>
                                <input type="text" id="suc_codigo" maxlength="20" placeholder="SUC001">
                            </div>
                            <div class="form-group">
                                <label>Nombre *</label>
                                <input type="text" id="suc_nombre" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Tipo</label>
                                <select id="suc_tipo">
                                    <option value="TIENDA">Tienda</option>
                                    <option value="BODEGA">Bodega</option>
                                    <option value="OFICINA">Oficina</option>
                                    <option value="FRANQUICIA">Franquicia</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Responsable</label>
                                <input type="text" id="suc_responsable" placeholder="Nombre del encargado">
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h4><i class="fas fa-map"></i> Dirección</h4>
                        <div class="form-group">
                            <label>Dirección</label>
                            <input type="text" id="suc_direccion" placeholder="Calle y número">
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Colonia</label>
                                <input type="text" id="suc_colonia">
                            </div>
                            <div class="form-group">
                                <label>Ciudad</label>
                                <input type="text" id="suc_ciudad">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Estado</label>
                                <input type="text" id="suc_estado">
                            </div>
                            <div class="form-group">
                                <label>Código Postal</label>
                                <input type="text" id="suc_codigo_postal" maxlength="10">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Latitud</label>
                                <input type="number" id="suc_latitud" step="0.00000001" placeholder="20.659698">
                            </div>
                            <div class="form-group">
                                <label>Longitud</label>
                                <input type="number" id="suc_longitud" step="0.00000001" placeholder="-103.349609">
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h4><i class="fas fa-phone"></i> Contacto</h4>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Teléfono</label>
                                <input type="tel" id="suc_telefono">
                            </div>
                            <div class="form-group">
                                <label>Email</label>
                                <input type="email" id="suc_email">
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h4><i class="fas fa-clock"></i> Horario</h4>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Hora Apertura</label>
                                <input type="time" id="suc_horario_apertura" value="09:00">
                            </div>
                            <div class="form-group">
                                <label>Hora Cierre</label>
                                <input type="time" id="suc_horario_cierre" value="20:00">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Días de Operación</label>
                            <input type="text" id="suc_dias_operacion" value="L,M,X,J,V,S" placeholder="L,M,X,J,V,S,D">
                            <small class="help-text">L=Lunes, M=Martes, X=Miércoles, J=Jueves, V=Viernes, S=Sábado, D=Domingo</small>
                        </div>
                    </div>

                    <div class="form-section">
                        <h4><i class="fas fa-cog"></i> Permisos y Estado</h4>
                        <div class="form-row form-row-4">
                            <div class="form-group switch-group">
                                <label>Venta</label>
                                <label class="switch">
                                    <input type="checkbox" id="suc_permite_venta" checked>
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="form-group switch-group">
                                <label>Compra</label>
                                <label class="switch">
                                    <input type="checkbox" id="suc_permite_compra" checked>
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="form-group switch-group">
                                <label>Traspaso</label>
                                <label class="switch">
                                    <input type="checkbox" id="suc_permite_traspaso" checked>
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="form-group switch-group">
                                <label>Activa</label>
                                <label class="switch">
                                    <input type="checkbox" id="suc_activa" checked>
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="cerrarModal('modalSucursal')">Cancelar</button>
                    <button type="submit" class="btn btn-success"><i class="fas fa-save"></i> Guardar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Almacén COMPLETO -->
    <div class="modal-overlay" id="modalAlmacen">
        <div class="modal">
            <div class="modal-header">
                <h3><i class="fas fa-warehouse"></i> <span id="modalAlmacenTitulo">Nuevo Almacén</span></h3>
                <button class="btn-close" onclick="cerrarModal('modalAlmacen')"><i class="fas fa-times"></i></button>
            </div>
            <form id="formAlmacen" onsubmit="guardarAlmacen(event)">
                <div class="modal-body">
                    <input type="hidden" id="alm_id">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Código</label>
                            <input type="text" id="alm_codigo" maxlength="20" placeholder="ALM001">
                        </div>
                        <div class="form-group">
                            <label>Nombre *</label>
                            <input type="text" id="alm_nombre" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Sucursal *</label>
                            <select id="alm_sucursal_id" required></select>
                        </div>
                        <div class="form-group">
                            <label>Tipo</label>
                            <select id="alm_tipo">
                                <option value="PRINCIPAL">Principal</option>
                                <option value="SECUNDARIO">Secundario</option>
                                <option value="DEVOLUCION">Devolución</option>
                                <option value="MERMA">Merma</option>
                                <option value="TRANSITO">Tránsito</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row form-row-3">
                        <div class="form-group switch-group">
                            <label>Punto de Venta</label>
                            <label class="switch">
                                <input type="checkbox" id="alm_es_punto_venta">
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="form-group switch-group">
                            <label>Permite Negativos</label>
                            <label class="switch">
                                <input type="checkbox" id="alm_permite_negativo">
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="form-group switch-group">
                            <label>Activo</label>
                            <label class="switch">
                                <input type="checkbox" id="alm_activo" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="cerrarModal('modalAlmacen')">Cancelar</button>
                    <button type="submit" class="btn btn-success"><i class="fas fa-save"></i> Guardar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Usuario COMPLETO -->
    <div class="modal-overlay" id="modalUsuario">
        <div class="modal modal-lg">
            <div class="modal-header">
                <h3><i class="fas fa-user"></i> <span id="modalUsuarioTitulo">Nuevo Usuario</span></h3>
                <button class="btn-close" onclick="cerrarModal('modalUsuario')"><i class="fas fa-times"></i></button>
            </div>
            <form id="formUsuario" onsubmit="guardarUsuario(event)">
                <div class="modal-body">
                    <input type="hidden" id="usr_id">
                    
                    <div class="form-section">
                        <h4><i class="fas fa-user"></i> Datos Personales</h4>
                        <div class="form-group">
                            <label>Nombre Completo *</label>
                            <input type="text" id="usr_nombre" required>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Email *</label>
                                <input type="email" id="usr_email" required>
                            </div>
                            <div class="form-group">
                                <label id="lbl_pass">Contraseña *</label>
                                <input type="password" id="usr_contrasena" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Avatar URL</label>
                            <input type="url" id="usr_avatar_url" placeholder="https://...avatar.jpg">
                        </div>
                    </div>

                    <div class="form-section">
                        <h4><i class="fas fa-shield-alt"></i> Rol y Permisos</h4>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Rol *</label>
                                <select id="usr_rol" required>
                                    <option value="Cajero">Cajero</option>
                                    <option value="Vendedor">Vendedor</option>
                                    <option value="Almacenista">Almacenista</option>
                                    <option value="Supervisor">Supervisor</option>
                                    <option value="Gerente">Gerente</option>
                                    <option value="Contador">Contador</option>
                                    <option value="Admin">Administrador</option>
                                    <option value="Solo_Lectura">Solo Lectura</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Sucursal Principal *</label>
                                <select id="usr_sucursal_id" required></select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Sucursales Permitidas</label>
                            <input type="text" id="usr_sucursales_permitidas" placeholder="Vacío = todas">
                            <small class="help-text">IDs separados por coma, vacío para todas</small>
                        </div>
                    </div>

                    <div class="form-section">
                        <h4><i class="fas fa-toggle-on"></i> Estado</h4>
                        <div class="form-row form-row-3">
                            <div class="form-group switch-group">
                                <label>Activo</label>
                                <label class="switch">
                                    <input type="checkbox" id="usr_activo" checked>
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="form-group switch-group">
                                <label>Bloqueado</label>
                                <label class="switch">
                                    <input type="checkbox" id="usr_bloqueado">
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="form-group">
                                <label>Intentos Fallidos</label>
                                <input type="number" id="usr_intentos_fallidos" value="0" readonly>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="cerrarModal('modalUsuario')">Cancelar</button>
                    <button type="submit" class="btn btn-success"><i class="fas fa-save"></i> Guardar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Impuesto COMPLETO -->
    <div class="modal-overlay" id="modalImpuesto">
        <div class="modal">
            <div class="modal-header">
                <h3><i class="fas fa-percent"></i> <span id="modalImpuestoTitulo">Nuevo Impuesto</span></h3>
                <button class="btn-close" onclick="cerrarModal('modalImpuesto')"><i class="fas fa-times"></i></button>
            </div>
            <form id="formImpuesto" onsubmit="guardarImpuesto(event)">
                <div class="modal-body">
                    <input type="hidden" id="imp_id">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Nombre *</label>
                            <input type="text" id="imp_nombre" required placeholder="Ej: IVA 16%">
                        </div>
                        <div class="form-group">
                            <label>Tipo</label>
                            <select id="imp_tipo">
                                <option value="PORCENTAJE">Porcentaje</option>
                                <option value="FIJO">Monto Fijo</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Valor *</label>
                            <input type="number" id="imp_valor" step="0.0001" required placeholder="16.0000">
                        </div>
                        <div class="form-group">
                            <label>Cuenta Contable</label>
                            <input type="text" id="imp_cuenta_contable" maxlength="20" placeholder="2150-001">
                        </div>
                    </div>
                    <div class="form-row form-row-4">
                        <div class="form-group switch-group">
                            <label>Incluido</label>
                            <label class="switch">
                                <input type="checkbox" id="imp_incluido_en_precio" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="form-group switch-group">
                            <label>Compras</label>
                            <label class="switch">
                                <input type="checkbox" id="imp_aplica_compras" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="form-group switch-group">
                            <label>Ventas</label>
                            <label class="switch">
                                <input type="checkbox" id="imp_aplica_ventas" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="form-group switch-group">
                            <label>Activo</label>
                            <label class="switch">
                                <input type="checkbox" id="imp_activo" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="cerrarModal('modalImpuesto')">Cancelar</button>
                    <button type="submit" class="btn btn-success"><i class="fas fa-save"></i> Guardar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Método de Pago COMPLETO -->
    <div class="modal-overlay" id="modalMetodoPago">
        <div class="modal">
            <div class="modal-header">
                <h3><i class="fas fa-credit-card"></i> <span id="modalMetodoPagoTitulo">Nuevo Método</span></h3>
                <button class="btn-close" onclick="cerrarModal('modalMetodoPago')"><i class="fas fa-times"></i></button>
            </div>
            <form id="formMetodoPago" onsubmit="guardarMetodoPago(event)">
                <div class="modal-body">
                    <input type="hidden" id="mp_id">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Nombre *</label>
                            <input type="text" id="mp_nombre" required placeholder="Ej: Efectivo">
                        </div>
                        <div class="form-group">
                            <label>Tipo</label>
                            <select id="mp_tipo">
                                <option value="EFECTIVO">Efectivo</option>
                                <option value="TARJETA_DEBITO">Tarjeta Débito</option>
                                <option value="TARJETA_CREDITO">Tarjeta Crédito</option>
                                <option value="TRANSFERENCIA">Transferencia</option>
                                <option value="CHEQUE">Cheque</option>
                                <option value="VALES">Vales</option>
                                <option value="PUNTOS">Puntos</option>
                                <option value="CREDITO_TIENDA">Crédito Tienda</option>
                                <option value="OTRO">Otro</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Comisión %</label>
                            <input type="number" id="mp_comision_porcentaje" step="0.01" min="0" value="0">
                        </div>
                        <div class="form-group">
                            <label>Comisión Fija $</label>
                            <input type="number" id="mp_comision_fija" step="0.01" min="0" value="0">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Cuenta Contable</label>
                            <input type="text" id="mp_cuenta_contable" maxlength="20" placeholder="1120-001">
                        </div>
                        <div class="form-group">
                            <label>Orden</label>
                            <input type="number" id="mp_orden" min="0" value="0">
                        </div>
                    </div>
                    <div class="form-row form-row-3">
                        <div class="form-group switch-group">
                            <label>Requiere Ref.</label>
                            <label class="switch">
                                <input type="checkbox" id="mp_requiere_referencia">
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="form-group switch-group">
                            <label>Permite Cambio</label>
                            <label class="switch">
                                <input type="checkbox" id="mp_permite_cambio">
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="form-group switch-group">
                            <label>Activo</label>
                            <label class="switch">
                                <input type="checkbox" id="mp_activo" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="cerrarModal('modalMetodoPago')">Cancelar</button>
                    <button type="submit" class="btn btn-success"><i class="fas fa-save"></i> Guardar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Unidad COMPLETO -->
    <div class="modal-overlay" id="modalUnidad">
        <div class="modal modal-sm">
            <div class="modal-header">
                <h3><i class="fas fa-balance-scale"></i> <span id="modalUnidadTitulo">Nueva Unidad</span></h3>
                <button class="btn-close" onclick="cerrarModal('modalUnidad')"><i class="fas fa-times"></i></button>
            </div>
            <form id="formUnidad" onsubmit="guardarUnidad(event)">
                <div class="modal-body">
                    <input type="hidden" id="uni_editing">
                    <div class="form-row">
                        <div class="form-group">
                            <label>ID/Código *</label>
                            <input type="text" id="uni_unidad_id" required maxlength="20" placeholder="PZA" style="text-transform:uppercase;">
                        </div>
                        <div class="form-group">
                            <label>Abreviatura *</label>
                            <input type="text" id="uni_abreviatura" required maxlength="10" placeholder="pza">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Nombre *</label>
                        <input type="text" id="uni_nombre" required placeholder="Pieza">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Tipo</label>
                            <select id="uni_tipo">
                                <option value="UNIDAD">Unidad</option>
                                <option value="PESO">Peso</option>
                                <option value="VOLUMEN">Volumen</option>
                                <option value="LONGITUD">Longitud</option>
                                <option value="TIEMPO">Tiempo</option>
                                <option value="AREA">Área</option>
                                <option value="OTRO">Otro</option>
                            </select>
                        </div>
                        <div class="form-group switch-group">
                            <label>Activo</label>
                            <label class="switch">
                                <input type="checkbox" id="uni_activo" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="cerrarModal('modalUnidad')">Cancelar</button>
                    <button type="submit" class="btn btn-success"><i class="fas fa-save"></i> Guardar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Categoría COMPLETO -->
    <div class="modal-overlay" id="modalCategoria">
        <div class="modal">
            <div class="modal-header">
                <h3><i class="fas fa-tag"></i> <span id="modalCategoriaTitulo">Nueva Categoría</span></h3>
                <button class="btn-close" onclick="cerrarModal('modalCategoria')"><i class="fas fa-times"></i></button>
            </div>
            <form id="formCategoria" onsubmit="guardarCategoria(event)">
                <div class="modal-body">
                    <input type="hidden" id="cat_id">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Código</label>
                            <input type="text" id="cat_codigo" maxlength="20" placeholder="CAT001">
                        </div>
                        <div class="form-group">
                            <label>Nombre *</label>
                            <input type="text" id="cat_nombre" required placeholder="Ej: Bebidas">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Categoría Padre</label>
                            <select id="cat_padre_id">
                                <option value="">-- Ninguna (Principal) --</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Orden</label>
                            <input type="number" id="cat_orden" min="0" value="0">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Descripción</label>
                        <textarea id="cat_descripcion" rows="2" placeholder="Descripción opcional"></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Color</label>
                            <div class="color-input">
                                <input type="color" id="cat_color" value="#3498db">
                                <input type="text" id="cat_color_text" value="#3498db" maxlength="20">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Icono</label>
                            <input type="text" id="cat_icono" maxlength="50" placeholder="fa-coffee">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Imagen URL</label>
                        <input type="url" id="cat_imagen_url" placeholder="https://...imagen.jpg">
                    </div>
                    <div class="form-row form-row-3">
                        <div class="form-group switch-group">
                            <label>Mostrar POS</label>
                            <label class="switch">
                                <input type="checkbox" id="cat_mostrar_pos" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="form-group switch-group">
                            <label>E-Commerce</label>
                            <label class="switch">
                                <input type="checkbox" id="cat_mostrar_ecommerce" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="form-group switch-group">
                            <label>Activo</label>
                            <label class="switch">
                                <input type="checkbox" id="cat_activo" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="cerrarModal('modalCategoria')">Cancelar</button>
                    <button type="submit" class="btn btn-success"><i class="fas fa-save"></i> Guardar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast"></div>

    <script src="../../shared/js/api.js"></script>
    <script src="empresas.js"></script>
</body>
</html>
